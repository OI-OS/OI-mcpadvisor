version: '3.8'

services:
  meilisearch:
    image: getmeili/meilisearch:v1.15
    container_name: mcpadvisor-meilisearch
    ports:
      - "7700:7700"
    environment:
      MEILI_MASTER_KEY: ${MEILI_MASTER_KEY:?Please set MEILI_MASTER_KEY environment variable}
      MEILI_ENV: ${MEILI_ENV:-development}
      MEILI_DB_PATH: /meili_data
      MEILI_HTTP_ADDR: 0.0.0.0:7700
      MEILI_LOG_LEVEL: INFO
      MEILI_MAX_INDEXING_MEMORY: 100MB
      MEILI_MAX_INDEXING_THREADS: 2
    volumes:
      - meili_data:/meili_data
      - meili_logs:/var/log/meilisearch
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '1'
        reservations:
          memory: 128M
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7700/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  meili_data:
  meili_logs: